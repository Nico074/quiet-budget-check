{% extends "layout_app.html" %}
{% block title %}Dashboard â€¢ Momentum Labs{% endblock %}
{% block content %}
<section class="dash-grid">
  <div class="kpi-card card">
    <span class="kpi-title">Health Score</span>
    <strong class="kpi-value">{{ health_score }}</strong>
    <span class="kpi-delta {% if health_trend >= 0 %}up{% else %}down{% endif %}">
      {% if health_trend >= 0 %}+{% endif %}{{ health_trend }} this week
    </span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Stable Streak</span>
    <strong class="kpi-value">{{ streaks.stable }} days</strong>
    <span class="kpi-delta up">Pace controlled</span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Adjustment Streak</span>
    <strong class="kpi-value">{{ streaks.adjust }} days</strong>
    <span class="kpi-delta">Small corrections</span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Risk Level</span>
    <strong class="kpi-value">{{ health_risk|title }}</strong>
    <span class="kpi-delta">{{ health_reason }}</span>
  </div>
</section>

<section class="analytics-grid">
  <article class="card analytics-main">
    <div class="card-head">
      <h2>Activity Tracker</h2>
      <div class="chip-row">
        <span class="chip">Monthly</span>
        <span class="chip">Auto</span>
      </div>
    </div>
    <svg viewBox="0 0 800 260" class="line-graph" role="img" aria-label="Activity trend chart">
      <defs>
        <linearGradient id="lineA" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#26f2b2"/>
          <stop offset="100%" stop-color="#47d8ff"/>
        </linearGradient>
      </defs>
      <polyline points="0,180 70,130 140,145 210,110 280,160 350,120 420,140 490,95 560,150 630,135 700,170 770,125 800,138"></polyline>
      <polyline class="secondary" points="0,210 70,165 140,178 210,185 280,146 350,170 420,160 490,150 560,172 630,148 700,159 770,146 800,152"></polyline>
    </svg>
    <div class="legend-row">
      <span><i class="dot a"></i> Stability</span>
      <span><i class="dot b"></i> Drift</span>
      <span><i class="dot c"></i> Cushion</span>
    </div>
  </article>

  <article class="card analytics-side">
    <div class="card-head">
      <h2>Brand Severity</h2>
    </div>
    <div class="donut-wrap">
      <svg viewBox="0 0 120 120" class="donut" role="img" aria-label="Risk donut">
        <circle cx="60" cy="60" r="44" class="track"></circle>
        {% set pct = health_score %}
        {% set dash = (pct * 2.76) %}
        <circle cx="60" cy="60" r="44" class="fill" style="stroke-dasharray: {{ dash }} 999;"></circle>
      </svg>
      <div class="donut-text">
        <strong>{{ health_score }}</strong>
        <small>{{ health_risk|title }}</small>
      </div>
    </div>
    <div class="severity-bars">
      <div><span>Stability</span><strong>{{ health_breakdown.stability }}%</strong></div>
      <div><span>Drift</span><strong>{{ health_breakdown.acceleration }}%</strong></div>
      <div><span>Cushion</span><strong>{{ health_breakdown.cushion }}%</strong></div>
    </div>
  </article>
</section>

<section class="platform-row card">
  <div class="card-head">
    <h2>Platform Distribution</h2>
  </div>
  <div class="platform-grid">
    {% for idx in range(1,6) %}
    <article class="platform-card">
      <div class="platform-preview"></div>
      <div class="platform-meta">
        <strong>Segment {{ idx }}</strong>
        <small>{{ (health_score + idx * 3) % 100 }} pts</small>
      </div>
      <div class="mini-bars">
        <span style="height: {{ 12 + idx * 3 }}px"></span>
        <span style="height: {{ 8 + idx * 4 }}px"></span>
        <span style="height: {{ 10 + idx * 2 }}px"></span>
        <span style="height: {{ 6 + idx * 3 }}px"></span>
      </div>
    </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
