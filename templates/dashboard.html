{% extends "layout_app.html" %}
{% block title %}Dashboard - Investing{% endblock %}
{% block content %}
<section class="dashboard-welcome">
  <h1>Welcome, {{ first_name|title }}!</h1>
  <p>Here is an overview of your investments.</p>
</section>

<section class="analytics-grid">
  <article class="analytics-main glass-strong">
    <div class="card-head">
      <h2>Portfolio Value</h2>
      <div class="chip-row">
        <span class="chip">1H</span>
        <span class="chip">TD</span>
        <span class="chip">1M</span>
        <span class="chip">1Y</span>
      </div>
    </div>

    <div class="portfolio-value">
      <strong>23,850 EUR</strong>
      <span class="up">+4.28% Today</span>
    </div>

    <svg viewBox="0 0 800 260" class="line-graph" role="img" aria-label="Portfolio trend chart">
      <polyline points="0,192 70,166 140,179 210,170 280,182 350,154 420,160 490,138 560,148 630,120 700,128 770,102 800,108"></polyline>
      <polyline class="secondary" points="0,216 70,198 140,205 210,202 280,197 350,188 420,192 490,182 560,186 630,178 700,180 770,170 800,174"></polyline>
    </svg>
  </article>

  <article class="analytics-side glass">
    <div class="card-head">
      <h2>Asset Allocation</h2>
    </div>
    <div class="donut-wrap">
      <svg viewBox="0 0 120 120" class="donut" role="img" aria-label="Asset allocation donut">
        <circle cx="60" cy="60" r="44" class="track"></circle>
        {% set pct = health_score %}
        {% set dash = (pct * 2.76) %}
        <circle cx="60" cy="60" r="44" class="fill" style="stroke-dasharray: {{ dash }} 999;"></circle>
      </svg>
      <div class="donut-text">
        <strong>{{ health_score }}</strong>
        <small>{{ health_risk|title }}</small>
      </div>
    </div>
    <div class="severity-bars">
      <div><span>Stocks</span><strong>{{ health_breakdown.stability }}%</strong></div>
      <div><span>Crypto</span><strong>{{ health_breakdown.acceleration }}%</strong></div>
      <div><span>Liquidity</span><strong>{{ health_breakdown.cushion }}%</strong></div>
    </div>
  </article>
</section>

<section class="dashboard-lower-grid">
  <article class="news-card glass">
    <div class="card-head">
      <h2>Latest News</h2>
      <a href="/history" class="chip">History</a>
    </div>
    <ul class="news-list">
      <li><a href="/history">The Fed keeps interest rates unchanged.</a><small>20:15</small></li>
      <li><a href="/goals">Tesla publishes quarterly results.</a><small>20:32</small></li>
      <li><a href="/run-check">New market opportunity detected.</a><small>21:03</small></li>
    </ul>
  </article>

  <article class="alerts-card glass">
    <div class="card-head">
      <h2>Market Alerts</h2>
      <span class="chip">Live</span>
    </div>
    <ul class="alerts-list">
      <li><span class="alert-dot"></span><span>Risk profile: {{ health_risk|title }}</span></li>
      <li><span class="alert-dot"></span><span>Weekly trend: {% if health_trend >= 0 %}+{% endif %}{{ health_trend }}</span></li>
      <li><span class="alert-dot"></span><span>{{ health_reason }}</span></li>
    </ul>
  </article>
</section>

<section class="dash-grid">
  <div class="kpi-card glass">
    <span class="kpi-title">Health Score</span>
    <strong class="kpi-value">{{ health_score }}</strong>
    <span class="kpi-delta {% if health_trend >= 0 %}up{% else %}down{% endif %}">{% if health_trend >= 0 %}+{% endif %}{{ health_trend }} this week</span>
  </div>

  <div class="kpi-card glass">
    <span class="kpi-title">Stable Streak</span>
    <strong class="kpi-value">{{ streaks.stable }} days</strong>
    <span class="kpi-delta up">Pace controlled</span>
  </div>

  <div class="kpi-card glass">
    <span class="kpi-title">Adjustment Streak</span>
    <strong class="kpi-value">{{ streaks.adjust }} days</strong>
    <span class="kpi-delta">Small corrections</span>
  </div>

  <div class="kpi-card glass">
    <span class="kpi-title">Risk Level</span>
    <strong class="kpi-value">{{ health_risk|title }}</strong>
    <span class="kpi-delta">{{ health_reason }}</span>
  </div>
</section>

<section class="watchlist-row glass">
  <div class="card-head">
    <h2>My Stocks</h2>
  </div>
  <div class="watchlist-table-wrap">
    <table class="watchlist-table">
      <thead>
        <tr>
          <th>Asset</th>
          <th>Signal</th>
          <th>Trend</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        {% for idx in range(1,6) %}
        <tr>
          <td>Segment {{ idx }}</td>
          <td>Live</td>
          <td>{% if (idx + health_trend) % 2 == 0 %}Up{% else %}Stable{% endif %}</td>
          <td>{{ (health_score + idx * 3) % 100 }} pts</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
