{% extends "layout_app.html" %}
{% block title %}Dashboard - Momentum Labs{% endblock %}
{% block content %}
<section class="dashboard-welcome">
  <h1>Bienvenue, Alex!</h1>
  <p>Voici un apercu de vos investissements.</p>
</section>

<section class="analytics-grid">
  <article class="card analytics-main">
    <div class="card-head">
      <h2>Valeur du Portefeuille</h2>
      <div class="chip-row">
        <span class="chip">1H</span>
        <span class="chip">TD</span>
        <span class="chip">1M</span>
      </div>
    </div>
    <div class="portfolio-value">
      <strong>23 850 EUR</strong>
      <span class="up">+4.28% Aujourd'hui</span>
    </div>
    <svg viewBox="0 0 800 260" class="line-graph" role="img" aria-label="Portfolio value trend chart">
      <defs>
        <linearGradient id="lineA" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#7ec7ff"/>
          <stop offset="100%" stop-color="#4d95ff"/>
        </linearGradient>
      </defs>
      <polyline points="0,192 70,166 140,179 210,170 280,182 350,154 420,160 490,138 560,148 630,120 700,128 770,102 800,108"></polyline>
      <polyline class="secondary" points="0,216 70,198 140,205 210,202 280,197 350,188 420,192 490,182 560,186 630,178 700,180 770,170 800,174"></polyline>
    </svg>
  </article>

  <article class="card analytics-side">
    <div class="card-head">
      <h2>Repartition des Actifs</h2>
    </div>
    <div class="donut-wrap">
      <svg viewBox="0 0 120 120" class="donut" role="img" aria-label="Asset allocation donut">
        <circle cx="60" cy="60" r="44" class="track"></circle>
        {% set pct = health_score %}
        {% set dash = (pct * 2.76) %}
        <circle cx="60" cy="60" r="44" class="fill" style="stroke-dasharray: {{ dash }} 999;"></circle>
      </svg>
      <div class="donut-text">
        <strong>{{ health_score }}</strong>
        <small>{{ health_risk|title }}</small>
      </div>
    </div>
    <div class="severity-bars">
      <div><span>Actions</span><strong>{{ health_breakdown.stability }}%</strong></div>
      <div><span>Crypto</span><strong>{{ health_breakdown.acceleration }}%</strong></div>
      <div><span>Liquidites</span><strong>{{ health_breakdown.cushion }}%</strong></div>
    </div>
  </article>
</section>

<section class="dashboard-lower-grid">
  <article class="card news-card">
    <div class="card-head">
      <h2>Dernieres Actualites</h2>
      <a href="/history" class="chip">Historique</a>
    </div>
    <ul class="news-list">
      <li>
        <a href="/history">La Fed maintient ses taux d'interet.</a>
        <small>20:15</small>
      </li>
      <li>
        <a href="/goals">Tesla publie ses resultats trimestriels.</a>
        <small>20:32</small>
      </li>
      <li>
        <a href="/run-check">Nouvelle opportunite sur les marches.</a>
        <small>21:03</small>
      </li>
    </ul>
  </article>

  <article class="card alerts-card">
    <div class="card-head">
      <h2>Alertes de Marche</h2>
      <span class="chip">Live</span>
    </div>
    <ul class="alerts-list">
      <li><span class="alert-dot"></span><span>Profil de risque: {{ health_risk|title }}</span></li>
      <li><span class="alert-dot"></span><span>Tendance hebdo: {% if health_trend >= 0 %}+{% endif %}{{ health_trend }}</span></li>
      <li><span class="alert-dot"></span><span>{{ health_reason }}</span></li>
    </ul>
  </article>
</section>

<section class="dash-grid">
  <div class="kpi-card card">
    <span class="kpi-title">Health Score</span>
    <strong class="kpi-value">{{ health_score }}</strong>
    <span class="kpi-delta {% if health_trend >= 0 %}up{% else %}down{% endif %}">
      {% if health_trend >= 0 %}+{% endif %}{{ health_trend }} this week
    </span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Stable Streak</span>
    <strong class="kpi-value">{{ streaks.stable }} days</strong>
    <span class="kpi-delta up">Pace controlled</span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Adjustment Streak</span>
    <strong class="kpi-value">{{ streaks.adjust }} days</strong>
    <span class="kpi-delta">Small corrections</span>
  </div>
  <div class="kpi-card card">
    <span class="kpi-title">Risk Level</span>
    <strong class="kpi-value">{{ health_risk|title }}</strong>
    <span class="kpi-delta">{{ health_reason }}</span>
  </div>
</section>

<section class="platform-row card watchlist-row">
  <div class="card-head">
    <h2>Mes Actions</h2>
  </div>
  <div class="watchlist-table-wrap">
    <table class="watchlist-table">
      <thead>
        <tr>
          <th>Actif</th>
          <th>Signal</th>
          <th>Tendance</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        {% for idx in range(1,6) %}
        <tr>
          <td>Segment {{ idx }}</td>
          <td>Live</td>
          <td>{% if (idx + health_trend) % 2 == 0 %}Up{% else %}Stable{% endif %}</td>
          <td>{{ (health_score + idx * 3) % 100 }} pts</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
