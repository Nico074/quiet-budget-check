{% extends "layout_app.html" %}
{% block title %}Dashboard — Momentum Labs{% endblock %}
{% block content %}
<section class="premium-hero card">
  <div>
    <div class="premium-title">Floor Overview</div>
    <div class="premium-sub">Clean signal. Less noise. Keep momentum visible.</div>
  </div>
  <div class="premium-chips">
    <span class="badge chip">Live</span>
    <span class="badge chip">Green Grid</span>
    <span class="badge chip">Demo Mode</span>
  </div>
</section>

<section class="kpi-grid">
  <article class="card metric-tile">
    <div class="label">Health score</div>
    <div class="value">{{ health_score }}</div>
    <div class="sub">{{ health_label }} · {{ health_risk|title }}</div>
  </article>
  <article class="card metric-tile">
    <div class="label">Stable streak</div>
    <div class="value">{{ streaks.stable }}</div>
    <div class="sub">days in a row</div>
  </article>
  <article class="card metric-tile">
    <div class="label">Adjustments</div>
    <div class="value">{{ streaks.adjust }}</div>
    <div class="sub">smart pace days</div>
  </article>
  <article class="card metric-tile">
    <div class="label">Goal streak</div>
    <div class="value">{{ streaks.goal }}</div>
    <div class="sub">contribution days</div>
  </article>
</section>

<section class="overview-grid">
  <article class="card chart-card">
    <div class="chart-head">
      <div>
        <div class="label">Momentum</div>
        <h3>Control panel chart</h3>
        <div class="muted">Structured view for trend, drift and runway.</div>
      </div>
      <div class="premium-chips">
        <span class="badge chip">Monthly</span>
        <span class="badge chip">Auto</span>
      </div>
    </div>
    <div class="chart-placeholder">Chart area</div>
  </article>

  <div class="side-stack">
    <article class="card tip-card">
      <div class="label">Smart tip</div>
      <h3>{{ health_reason }}</h3>
      <div class="muted">{% if health_steps and health_steps|length > 0 %}{{ health_steps[0] }}{% else %}Keep your current pace — it’s working.{% endif %}</div>
    </article>
    <details class="card detail-card">
      <summary>Metric breakdown</summary>
      <div class="detail-grid">
        <div>Stability <strong>{{ health_breakdown.stability }}%</strong></div>
        <div>Drift <strong>{{ health_breakdown.acceleration }}%</strong></div>
        <div>Cushion <strong>{{ health_breakdown.cushion }}%</strong></div>
        <div>Runway <strong>{{ health_breakdown.runway }}%</strong></div>
        <div>Fixed ratio <strong>{{ 100 - health_breakdown.affordability }}%</strong></div>
        <div>Goal alignment <strong>{{ health_breakdown.goal_alignment }}%</strong></div>
      </div>
    </details>
  </div>
</section>

<section class="card table-card">
  <div class="table-head">
    <div>
      <h3>Recent checks</h3>
      <div class="muted">Last {{ history|length }} entries</div>
    </div>
    <a class="btn" href="/history">Open history</a>
  </div>

  <div class="table-wrap">
    <table class="premium-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Daily budget</th>
          <th>Status</th>
          <th>Note</th>
        </tr>
      </thead>
      <tbody>
        {% for item in history %}
        <tr>
          <td>{{ item.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
          <td>${{ "%.2f"|format(item.daily_budget) }}</td>
          <td><span class="badge chip">{{ item.status }}</span></td>
          <td>{{ item.message }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
