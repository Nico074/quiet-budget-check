{% extends "layout_app.html" %}
{% block title %}Upgrade • Momentum Labs{% endblock %}
{% block content %}
<section class="premium-hero card">
  <div>
    <div class="premium-title">Upgrade to Pro</div>
    <div class="premium-sub">A calmer plan for better momentum and clearer control.</div>
  </div>
  <div class="premium-chips">
    <a class="btn" href="/billing">View billing</a>
  </div>
</section>

<section class="upgrade-grid">
  <article class="card" style="padding:16px;">
    <div class="compare-head">
      <h3>Plan comparison</h3>
      <div class="pill">Save 20% yearly</div>
    </div>
    <div class="plan-toggle">
      <button class="toggle-btn active" type="button" data-plan="monthly">Monthly</button>
      <button class="toggle-btn" type="button" data-plan="yearly">Yearly</button>
    </div>
    <div class="plan-grid">
      <div class="plan-card">
        <div class="plan-title">{{ plans.free.name }}</div>
        <div class="plan-price">$0</div>
        <ul class="plan-list">
          {% for f in plans.free.features %}
          <li>{{ f }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="plan-card featured">
        <div class="plan-title">{{ plans.pro.name }}</div>
        <div class="plan-price" id="proPrice">${{ plans.pro.price_monthly }}<span>/month</span></div>
        <ul class="plan-list">
          {% for f in plans.pro.features %}
          <li>{{ f }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </article>

  <article class="card" style="padding:16px;">
    <div class="checkout-head">
      <h3>Checkout</h3>
      <div class="muted small">Secure Stripe Checkout (test mode).</div>
    </div>
    {% if error %}
    <div class="form-error">{{ error }}</div>
    {% endif %}
    <form method="post" action="/checkout" class="premium-form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <input type="hidden" name="plan_interval" id="planInterval" value="monthly" />
      <label class="full">
        <span>Email</span>
        <input type="email" value="{{ email or '' }}" placeholder="you@email.com" readonly />
      </label>
      <button class="btn primary full" id="checkoutBtn" type="submit">Continue to Stripe</button>
    </form>
    <div class="trust-row">
      <span>Cancel anytime</span>
      <span>No data sold</span>
      <span>Secure payments</span>
    </div>
  </article>
</section>
{% endblock %}

{% block scripts %}
<script>
  const toggleButtons = document.querySelectorAll(".toggle-btn");
  const proPrice = document.getElementById("proPrice");
  const planInterval = document.getElementById("planInterval");
  const checkoutBtn = document.getElementById("checkoutBtn");
  toggleButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      toggleButtons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
      if (btn.dataset.plan === "yearly") {
        proPrice.innerHTML = "$" + {{ plans.pro.price_yearly }} + "<span>/year</span>";
        if (planInterval) planInterval.value = "yearly";
      } else {
        proPrice.innerHTML = "$" + {{ plans.pro.price_monthly }} + "<span>/month</span>";
        if (planInterval) planInterval.value = "monthly";
      }
    });
  });
  const checkoutForm = document.querySelector("form[action='/checkout']");
  if (checkoutForm && checkoutBtn) {
    checkoutForm.addEventListener("submit", () => {
      checkoutBtn.disabled = true;
      checkoutBtn.textContent = "Redirecting…";
    });
  }

</script>
{% endblock %}
